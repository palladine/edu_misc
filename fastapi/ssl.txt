Настройка HTTPS для FastAPI на различных операционных системах
Чтобы настроить HTTPS для FastAPI на Windows, macOS и Linux, вам потребуется создать SSL-сертификаты и настроить 
FastAPI для работы с HTTPS. Ниже приведено подробное руководство по этим шагам.

Шаг 1: Перейдите в папку проекта
Откройте командную строку или PowerShell и перейдите в папку вашего проекта. 
Например, если ваш проект находится в E:\Desktop\my_project, выполните команду:
cd E:\Desktop\my_project

Шаг 2: Создание SSL-сертификатов
Для создания SSL-сертификатов вам потребуется OpenSSL. В зависимости от ваших потребностей, 
вы можете выбрать один из следующих подходов:


Первый подход: Создание ключа и сертификата отдельно

1. Создание закрытого ключа
Чтобы создать закрытый ключ с шифрованием AES-256, используйте следующую команду. 
Вам будет предложено ввести пароль для шифрования ключа:

openssl genpkey -algorithm RSA -out key.pem -aes256

Если вы предпочитаете создать ключ без шифрования (без пароля), выполните:

openssl genpkey -algorithm RSA -out key.pem

2. Создание запроса на сертификат (CSR)
CSR (Certificate Signing Request) содержит информацию о вашем сертификате, 
такую как имя организации и местоположение. Этот запрос можно отправить в центр сертификации (CA) 
для подписания, если вы хотите получить сертификат от внешнего CA:

openssl req -new -key key.pem -out cert.csr

3. Создание самоподписанного сертификата
Самоподписанный сертификат можно создать, используя ваш CSR и закрытый ключ. 
Этот метод подходит для тестирования и разработки. Для продакшн-окружения сертификат 
должен быть подписан авторитетным CA:

openssl x509 -req -days 365 -in cert.csr -signkey key.pem -out cert.pem

Второй подход: Создание ключа и сертификата в одном шаге
Этот метод объединяет создание ключа и сертификата в одном шаге и подходит для тестирования и разработки:

openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout key.pem -out cert.pem

-newkey rsa:2048: Создаёт новый закрытый ключ RSA с длиной 2048 бит.
-x509: Указывает, что нужно создать самоподписанный сертификат.
-nodes: Указывает, что ключ не должен быть защищён паролем.
-days 365: Определяет срок действия сертификата (в данном случае 365 дней).
-keyout key.pem и -out cert.pem: Указывают выходные файлы для ключа и сертификата соответственно.

Примечание по длине пароля
При вводе пароля для шифрования ключа убедитесь, что он содержит от 4 до 511 символов. 
Пароль слишком короткий или длинный вызовет ошибку!

Country Name (2 letter code): Введите код вашей страны (например, US для США, RU для России).
State or Province Name (full name): Введите название вашего штата или региона (например, California, Moscow).
Locality Name (e.g. city): Введите название вашего города (например, Los Angeles, Moscow).
Organization Name (e.g. company): Введите название вашей организации или компании (например, My Company, My Organization).
Organizational Unit Name (e.g. section): Введите название подразделения вашей организации, если это применимо (например, IT Department, Development).
Common Name (e.g. server FQDN or YOUR name): Введите имя сервера или ваше имя. Это может быть доменное имя вашего сервера или просто localhost, если это для тестирования.
Email Address: Введите адрес электронной почты (можно оставить пустым, если не требуется).

 
В папке с проектом должны появится два файла key.pem и cert.pem!


Шаг 3: Настройка FastAPI для использования HTTPS
Создайте файл main.py с примером приложения FastAPI:

from fastapi import FastAPI

app = FastAPI()

@app.get("/")

async def root():

    return {"message": "Hello, HTTPS!"}


Шаг 4: Запуск FastAPI с HTTPS

4.1 Запуск на macOS и Linux
1. Установите зависимости:
Теперь ваше приложение будет доступно по HTTPS на порту 8000. Например: https://localhost:8000.

pip install fastapi uvicorn

2. Запустите приложение с SSL-сертификатом:
uvicorn main:app --host 0.0.0.0 --port 8000 --ssl-keyfile=key.pem --ssl-certfile=cert.pem

 

4.2 Запуск на Windows
1 .Убедитесь, что OpenSSL установлен и доступен из командной строки.
Официальный сайт OpenSSL не предоставляет прямых установщиков для Windows, но можно использовать сторонние сборки. Популярный источник — slproweb.

2. Выберите и скачайте установочный файл:
Для 64-битной системы скачайте Win64 OpenSSL v1.1.1x или новее.
Для 32-битной системы скачайте Win32 OpenSSL v1.1.1x.

3. Установите OpenSSL:
1. Выберите опцию для добавления OpenSSL в системный PATH. Если вы пропустили этот шаг, добавьте путь вручную.
1.1 Проверьте версию OpenSSL:

openssl version

Если OpenSSL установлен правильно, вы увидите информацию о версии!

2. Добавьте OpenSSL в переменную среды PATH вручную если openssl version выдает ошибку:
2.1 Нажмите Win + X и выберите Система.
2.2 Перейдите в Дополнительные параметры системы.
2.3 В окне Свойства системы выберите Переменные среды.
2.4 Найдите переменную Path в разделе Системные переменные, выберите её и нажмите Изменить.
2.5 Добавьте путь к папке с установленным OpenSSL (например, C:\Program Files\OpenSSL-Win64\bin).
2.6 Перезапустите командную строку и вновь введите openssl version.

4. Запустите приложение FastAPI с SSL-сертификатом так же, как на macOS и Linux:

uvicorn main:app --host 0.0.0.0 --port 8000 --ssl-keyfile=key.pem --ssl-certfile=cert.pem

Шаг 5: Проверка
Откройте браузер и перейдите по адресу https://localhost:8000. Поскольку сертификат самоподписанный, 
браузер может предупредить вас о ненадежном соединении. Это нормально для локальной разработки — 
просто примите предупреждение и продолжите.

Шаг 6: Использование Nginx для управления HTTPS (по желанию)
Для более продвинутой настройки в продакшн-окружении вы можете использовать Nginx в качестве обратного 
прокси-сервера для управления HTTPS.